var filas = [
    {
        id: 'lethal-row',
        codigo: '123',
        clase:'',
        nombre: 'Lethal Company',
        categoria: 'Aventura',
        descripcion: 'Lootear y conseguir materiales para la compañía.',
        descripcionLarga: 'Eres un trabajador contratado por la Compañía. Tu trabajo consiste en recoger chatarra de lunas abandonadas e industrializadas para cumplir la cuota de beneficios de la Compañía. Puedes usar el dineroque ganes para viajar a nuevas lunas con mayores riesgos y recompensas...o puedes comprar trajes de lujo y decoraciones para tu nave.',
        checked: 'checked',
        img: '/assets/images/header.jpg',
        iframe:'https://www.youtube.com/embed/qQFUol6k-ig?si=Pr8DyYhFi4oPVQmK',
        iframeMinimizado: '/assets/images/lctrailer.jpg',
        img1: '/assets/images/lc1.jpg',
        img2: '/assets/images/lc2.jpg',
        img3: '/assets/images/lc3.jpg',
        img4: '/assets/images/lc4.jpg',            
    },
    
    {
        id: 'battlefield-row',
        codigo: '124',
        clase:'',
        nombre: 'BATTLEFIELD',
        categoria: 'Acción',
        descripcion: 'disparos y terrorismo.',
        descripcionLarga: 'Domina lo desconocido en la temporada 6. Battlefield™ 2042 es un juego del tipo FPS. Battlefield™ 2042 es un shooter en primera persona que marca el regreso a la emblemática guerra total de la franquicia. Con la ayuda de un arsenal de vanguardia, participa en batallas multijugador intensas e inmersivas. Contiene Violencia y disparos.',
        checked: 'checked',
        img:'https://cdn.akamai.steamstatic.com/steam/apps/1517290/header.jpg',
        iframe:'https://www.youtube.com/embed/WomAGoEh-Ss?si=tVPki-934v5xgZJB',
        iframeMinimizado: 'https://cdn.akamai.steamstatic.com/steam/apps/256975021/movie.184x123.jpg?t=1696978137',
        img1: 'https://cdn.cloudflare.steamstatic.com/steam/apps/1517290/ss_5b422e52477416a027dc3a4373cdd5332a1f341f.600x338.jpg?t=1703193378',
        img2: 'https://cdn.cloudflare.steamstatic.com/steam/apps/1517290/ss_a7ebde7fe03f57e06e53f830b1345a3af9279864.600x338.jpg?t=1703193378',
        img3: 'https://cdn.cloudflare.steamstatic.com/steam/apps/1517290/ss_4c3e1fbdc6c02ba04fc6b37bba55a444fa4e11b4.600x338.jpg?t=1703193378',
        img4: 'https://cdn.cloudflare.steamstatic.com/steam/apps/1517290/ss_a09922fccf91b6842577511fa04459b70725d6b1.600x338.jpg?t=1703193378',              
    },

    {
        id: 'fc24-row',
        codigo: '125',
        clase:'',
        nombre: 'FC24',
        categoria: 'Deportes',
        descripcion: 'Que viva el fulbol.',
        descripcionLarga: '¡Asegurate de anotar muchos goles para ganar a todos y ser el mejor del mundo! EA Sports FC 24 es un videojuego de fútbol, desarrollado por EA, y publicado por EA Sports. Este juego marca la primera entrega de la serie EA Sports FC tras la conclusión de la asociación de EA con FIFA. Fue lanzado a nivel mundial el 29 de septiembre de 2023.',
        checked: 'checked',
        img:'https://cdn.akamai.steamstatic.com/steam/apps/2195250/header.jpg',
        iframe:'https://www.youtube.com/embed/-vL01jbgENE?si=rEncnWIOJVZfCA6S',
        iframeMinimizado: 'https://www.mundodeportivo.com/alfabeta/hero/2023/07/ea-sports-fc-24-announce-trailer-a-768x443-1.webp?width=768&aspect_ratio=16:9&format=nowebp',
        img1: 'https://cdn.cloudflare.steamstatic.com/steam/apps/2195250/ss_33527a88323cbb39a7c09d7d74955015343efd3f.600x338.jpg',
        img2: 'https://cdn.cloudflare.steamstatic.com/steam/apps/2195250/ss_96496b17bd35a97ceb926231e963762d3b86c3c8.600x338.jpg',
        img3: 'https://cdn.cloudflare.steamstatic.com/steam/apps/2195250/ss_6c1ef918ffe94050e72dcb2cfad3a95ee3d69f08.600x338.jpg',
        img4: 'https://cdn.cloudflare.steamstatic.com/steam/apps/2195250/ss_f3d31c7cffc2a6ab42fb76aaac2bc9d5258bc142.600x338.jpg',
    },

    {
        id: 'hogwarts-row',
        codigo: '127',
        clase:'',
        nombre: 'Hogwarts Legacy',
        categoria: 'Rol',
        descripcion: 'Adentrate en el mundo de la magia.',
        descripcionLarga: 'Hogwarts Legacy es un RPG de acción en un mundo abierto. Ahora puedes tomar el control de la acción y ser el centro de tu propia aventura en el mundo mágico. Hogwarts Legacy es un RPG de acción en un mundo abierto. Ahora puedes tomar el control de la acción y ser el centro de tu propia aventura en el mundo mágico.',
        checked: 'checked',
        img:'https://cdn.akamai.steamstatic.com/steam/apps/990080/header.jpg',
        iframe:'https://www.youtube.com/embed/S6GTl_vPRvU?si=qx6qzpBs1tElXReo',
        iframeMinimizado: 'https://cdn.akamai.steamstatic.com/steam/apps/256930504/movie.184x123.jpg',
        img1: 'https://cdn.cloudflare.steamstatic.com/steam/apps/990080/ss_725bf58485beb4aa37a3a69c1e2baa69bf3e4653.600x338.jpg',
        img2: 'https://cdn.cloudflare.steamstatic.com/steam/apps/990080/ss_8e08976236d29b1897769257ac3c64e9264792a5.600x338.jpg',
        img3: 'https://cdn.cloudflare.steamstatic.com/steam/apps/990080/ss_df93b5e8a183f7232d68be94ae78920a90de1443.600x338.jpg',
        img4: 'https://cdn.cloudflare.steamstatic.com/steam/apps/990080/ss_94058497bf0f8fabdde17ee8d59bece609a60663.600x338.jpg',
        
    },

    {
        id: 'gtavi-row',
        codigo: '165',
        clase:'table-success',
        nombre: 'GTA VI',
        categoria: 'Acción',
        descripcion: 'Vive la vida loca.',
        descripcionLarga: 'Grand Theft Auto VI (abreviado como GTA VI o GTA 6) es un próximo videojuego que está siendo desarrollado por Rockstar Games. Será la octava entrega principal de dicha serie, tras Grand Theft Auto V de 2013, y la decimosexta en total. Tras años de especulaciones y filtraciones.',
        checked: 'checked',
        img:'https://grupovierci.brightspotcdn.com/dims4/default/b4a04f6/2147483647/strip/false/crop/1920x1080+0+0/resize/1486x836!/quality/90/?url=https%3A%2F%2Fk2-prod-grupo-vierci.s3.us-east-1.amazonaws.com%2Fbrightspot%2F87%2Fb1%2F502a59b94b4da2c7c505ed4ea985%2Fgta-6.jfif',
        iframe: 'https://www.youtube.com/embed/QdBZY2fkU-0?si=26OnQF0YdHKoQDUS',
        iframeMinimizado: 'https://cloudfront-us-east-1.images.arcpublishing.com/elespectador/6K7MQGIXJNHP5GCVKCFMIBOC4E.jpg',
        img1: 'https://sm.ign.com/t/ign_es/news/e/ex-rocksta/ex-rockstar-dev-reacts-to-gta-6-trailer-its-really-going-to_rbvh.960.jpg',
        img2: 'https://sm.ign.com/t/ign_es/photo/e/ex-rocksta/ex-rockstar-dev-reacts-to-gta-6-trailer-its-really-going-to_ju9s.960.jpg',
        img3: 'https://media.tycsports.com/files/2023/12/04/652912/gta-6-cuando-sale-a-la-venta-y-a-que-precio_1440x810_wmk.webp',
        img4: 'https://www.dexerto.fr/cdn-cgi/image/width=3840,quality=75,format=auto/https://editors.dexerto.fr/wp-content/uploads/sites/2/2023/11/06/gta-6-devrait-apporter-changement-armes-majeur-inspire-de-red-dead-redemption.jpg',
        
    }
];
localStorage.setItem('filas', JSON.stringify(filas));
let juegoDestacado = 'gtavi-row';
localStorage.setItem('juegoDestacado', juegoDestacado);


function destacar(destacarId){
    localStorage.setItem('juegoDestacado', destacarId);
    let destacarJuego = localStorage.getItem('juegoDestacado');
    console.log(destacarJuego);
    console.log('ese es el juego destacado')
    filas = JSON.parse(localStorage.getItem('filas'));
    let filaDestacar = document.getElementById(destacarId);
    for(let i=0; i<filas.length; i++){
        if(destacarId === filas[i].id){
            if(filas[i].clase.includes('table-success') && filaDestacar.classList.contains('table-success')){
                filas[i].clase = 'table-light';
                filaDestacar.classList.remove('table-success');
                filaDestacar.classList.add('table-light');
                localStorage.setItem('filas', JSON.stringify(filas));     
            }
            else{
                filas[i].clase = 'table-success';
                filaDestacar.classList.add('table-success');
                filaDestacar.classList.remove('table-light');
                localStorage.setItem('filas', JSON.stringify(filas));         
            }
        }
        else{
            let filaNormal = document.getElementById(filas[i].id);
            if(filas[i].clase.includes('table-success') && filaNormal.classList.contains('table-success')){
                filas[i].clase = 'table-light' ;
                filaNormal.classList.remove('table-success');
                filaNormal.classList.add('table-light') ;
                localStorage.setItem('filas', JSON.stringify(filas));       
            }
            else if(!(filas[i].clase.includes('table-light'))){
                filas[i].clase = 'table-light';
                filaNormal.classList.add('table-light');
                localStorage.setItem('filas', JSON.stringify(filas));   
            }
        }        
    }   
}

function borrar(borrarId){
    filas = JSON.parse(localStorage.getItem('filas')); //Obtengo el array de objetos
    filas.splice(buscar(borrarId, filas), 1);
    console.log(filas)
    localStorage.setItem('filas', JSON.stringify(filas));
    location.reload();
}



function agregarJuego() {
    filas = JSON.parse(localStorage.getItem('filas'));
    //Recupera los datos de los input
    let nuevoCodigo = document.querySelector('#codigo').value;
    let nuevoNombre = document.querySelector('#nombre').value;
    let nuevoId = nuevoNombre + '-row';
    let nuevoCategoria = document.querySelector('#categoria').value;
    let nuevoDesc = document.querySelector('#descripcion').value;
    let nuevoChecked = document.querySelector('#disponible').value;
    //Setear el checked
    nuevoChecked = nuevoChecked.toLowerCase();
    if (nuevoChecked !== 'si' && nuevoChecked !== 'no') {
        nuevoChecked = 'checked';
    }
    else if (nuevoChecked === 'si') {
        nuevoChecked = 'checked';
    }
    else {
        nuevoChecked = '';
    }
    //Para ver que se hayan puesto todos los datos
    let todos = true;
    do{
        if(nuevoCodigo === ''){
            nuevoCodigo = prompt('Debe ingresar un codigo');
            todos = false;
        }
        else if(nuevoNombre === ''){
            nuevoNombre = prompt('Debe ingresar un nombre');
            todos = false;
        }
        else if(nuevoCategoria === ''){
            nuevoCategoria = prompt('Debe ingresar una categoria');
            todos = false;
        }
        else if(nuevoDesc === ''){
            nuevoDesc = prompt('Debe ingresar una categoria');
            todos = false;
        }
        else if(nuevoChecked === ''){
            nuevoChecked = prompt('Debe ingresar si esta disponible');
            todos = false;
        }
        else{
            todos = true;
        };
    }while(todos==false);
    
    //Para ver que no se repita el codigo
    for (let i = 0; i < filas.length; i++) {
        console.log('funciona el for');
        if (filas[i].codigo === nuevoCodigo) {
            console.log('entra al if');
            nuevoCodigo = prompt('Este codigo ya está en uso, ingrese uno nuevo: ');
            i = 0;
        }
    }





    //Crea un objeto nuevo para agregar al array de objetos Fila
    var nuevoObjeto = {
        id: nuevoId,
        clase: '',
        codigo: nuevoCodigo,
        nombre: nuevoNombre,
        categoria: nuevoCategoria,
        descripcion: nuevoDesc,
        checked: nuevoChecked,
    };
    filas.push(nuevoObjeto);
    localStorage.setItem('filas', JSON.stringify(filas));
    location.reload();
}

function editarJuego(){
    filas = JSON.parse(localStorage.getItem('filas'));
    //Recupera los datos de los input
    let nuevoCodigo = document.querySelector('#codigo-editar').value;
    let nuevoNombre = document.querySelector('#nombre-editar').value;
    let nuevoId = nuevoNombre + '-row';
    let nuevoCategoria = document.querySelector('#categoria-editar').value;
    let nuevoDesc = document.querySelector('#descripcion-editar').value;
    let nuevoChecked = document.querySelector('#disponible-editar').value;
    nuevoChecked = nuevoChecked.toLowerCase();
    if(nuevoChecked === '' || (nuevoChecked !== 'si' && nuevoChecked !== 'no')){
        nuevoChecked = 'none';
    }
    else if(nuevoChecked === 'si'){
        nuevoChecked = 'checked';
    }
    else{
        nuevoChecked = '';
    }
    //Para ver que el codigo no coincida con otro
    for (let i = 0; i < filas.length; i++) {
        console.log('funciona el for');
        if (filas[i].codigo === nuevoCodigo) {
            console.log('entra al if');
            nuevoCodigo = prompt('Este codigo ya está en uso, ingrese uno nuevo: ');
            i = 0;
        }
    }
    //Recupera los datos de la id de la fila a editar y de las filas desde el Local Storage
    let editarId = localStorage.getItem('editarId');
    
    //Recorre el arreglo en busca del objeto que tiene la misma id de la que se busca editar
    for(let i=0; i<filas.length; i++){
        if(filas[i].id === editarId){
            if(nuevoCodigo.length != 0){
                filas[i].codigo = nuevoCodigo;
                localStorage.setItem('filas', JSON.stringify(filas));
            }
            if(nuevoNombre.length != 0){
                filas[i].nombre = nuevoNombre;
                filas[i].id = nuevoId;
                localStorage.setItem('filas', JSON.stringify(filas));        
            }
            if(nuevoCategoria.length != 0){
                filas[i].categoria = nuevoCategoria;
                localStorage.setItem('filas', JSON.stringify(filas));                               
            }
            if(nuevoDesc.length != 0){
                filas[i].descripcion = nuevoDesc;
                localStorage.setItem('filas', JSON.stringify(filas));                
            }
            if(nuevoChecked !== 'none'){
                filas[i].checked = nuevoChecked;
                localStorage.setItem('filas', JSON.stringify(filas));
            }        
        }
        
    }
    location.reload();
}

// <========================== FUNCIONES SOPORTE =========================>

//FUNCION PARA BUSCAR EL INDICE DEL OBJETO QUE QUIERE BORRAR
function buscar(idBuscar, objectArray){
    console.log('entra al buscar');
    for(var i=0; i<objectArray.length; i++){
        console.log('entra al for');
        if(objectArray[i].id === idBuscar){
            console.log('entra al if');
            console.log(objectArray[i].id);
            console.log(i); //Busca el objeto que coincida
            return i; //Devuelve su indice
        }
    }
}

//FUNCION PARA GUARDAR LA ID QUE SE QUIERE EDITAR EN LOCALSTORAGE
function enviarId(idEditar){ 
    let editarId = idEditar;
    localStorage.setItem('editarId', editarId);
    console.log(editarId);
}

//FUNCION PARA CAMBIAR EL ESTADO DEL CHECKED 
function guardarCheckbox(checkboxFilaId) {		
    filas = JSON.parse(localStorage.getItem('filas'));
    for(let i=0; i<filas.length; i++){
        if(filas[i].id === checkboxFilaId){
            if(filas[i].checked === 'checked'){
                filas[i].checked = '';
                localStorage.setItem('filas', JSON.stringify(filas));
            }
            else{
                filas[i].checked = 'checked';
                localStorage.setItem('filas', JSON.stringify(filas));
            }
        }
    }
}

var filas = JSON.parse(localStorage.getItem('filas'));
var filaDatos = filas.map(fila =>{
    var tabla = document.querySelector('tbody');
    tabla.innerHTML += `
    <tr class="table-row ${fila.clase}" id="${fila.id}">
        <th scope="row">${fila.codigo}</th>
        <td>${fila.nombre}</td>
        <td>${fila.categoria}</td>
        <td class="descripcion-columna">${fila.descripcion}</td>
        <td class="text-center"><input class="checkbox" id="checkbox-${fila.id}" type="checkbox" ${fila.checked} onclick="guardarCheckbox('${fila.id}')"></td>
        <td class="d-flex opciones-botones">
            <img src="/assets/images/trash-solid.svg" alt="Eliminar" id="eliminar" onclick="borrar('${fila.id}')">
            <img src="/assets/images/pen-to-square-regular.svg" alt="Editar" id="editar" data-bs-toggle="modal" data-bs-target="#editarModal" onclick="enviarId('${fila.id}')">
            <img src="/assets/images/star-regular.svg" alt="Destacar" id="destacar" onclick ="destacar('${fila.id}')">
        </td>
    </tr>
    `
});